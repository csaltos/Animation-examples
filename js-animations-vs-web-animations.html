<!doctype html>
<html>
	<head>
		<title>JS Animations vs Web Animations</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="styles.css" type="text/css">
		<script src="lib/Tween.js"></script>
	</head>
	<body>
		<h1><input type="button" value="JavaScript Animations" id="jsanims" /> vs <input type="button" value="Web Animations" id="webanims" /></h1>
		<main>
			<div id="elements">
			</div>
		</main>
		<script>
			window.onload = function() {
				var numElements = 10;
				var elementsContainer = document.getElementById('elements');
				var objs = [];
				var rafId;
				var tweenLength = 1000;
				
				for(var i = 0; i < numElements; i++) {
					var el = document.createElement('div');
					elementsContainer.appendChild(el);
					var x0 = getRandomInRange(100);
					var x1 = getRandomInRange(200);

					setDivX(el, x0);
					objs.push({ x0: x0, x1: x1, x: x0, el: el });
				}

				document.getElementById('jsanims').addEventListener('click', startJSAnimations);
				document.getElementById('webanims').addEventListener('click', startWebAnimations);

				function getRandomInRange(range) {
					return Math.floor(range * (Math.random() - 0.5));
				}

				function setDivX(div, x) {
					var str = 'translateX(' + x + 'px)';
					div.style.transform = str;
				}

				function stopAnimations() {
					console.log('stop!');
					cancelAnimationFrame(rafId);
					rafId = null;
					TWEEN.getAll().forEach((t) => t.stop());
					TWEEN.removeAll();
				}

				function startJSAnimations() {
					stopAnimations();
					console.log('js animations');

					objs.forEach((obj) => {

						obj.x = obj.x0;

						new TWEEN.Tween(obj)
							.to({ x: obj.x1 }, tweenLength)
							.onStart(() => {
								setDivX(obj.el, obj.x0);
							})
							.onUpdate(() => {
								setDivX(obj.el, obj.x);
							})
							.easing(TWEEN.Easing.Quadratic.Out)
							.repeat(Infinity)
							.start();

					});
					
					rafId = requestAnimationFrame(render);

				}

				function render(timestamp) {
					
					if(rafId) {
						requestAnimationFrame(render);
						TWEEN.update(timestamp);
					}
				}

				function startWebAnimations() {
					stopAnimations();
					console.log('web animations');


				}


			};
		</script>
		<style>
			h1 {
				z-index: 1000;
				position: relative;
			}

			input {
				font-size: inherit;
			}

			main {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 0;
			}

			#elements {
				height: 100%;
				width: 100%;
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				align-items: center;
			}

			#elements > div {
				width: 50%;
				xheight: 3px;
				flex-grow: 1;
				background-color: #800;
				
			}
		</style>
	</body>
</html>
